(function(){"use strict";var e={4737:function(e,t,n){var s=n(5130),o=n(6768);const a=(0,o.Lk)("table",null,null,-1);function r(e,t,n,s,r,i){const l=(0,o.g2)("ChatContent");return(0,o.uX)(),(0,o.CE)(o.FK,null,[a,(0,o.bF)(l)],64)}const i=e=>((0,o.Qi)("data-v-01a60c90"),e=e(),(0,o.jt)(),e),l={id:"content"},c=i((()=>(0,o.Lk)("div",{class:"title"}," Gemma大模型 ",-1))),u={class:"chat-container"},h={class:"chat-log"},g=["innerHTML"],d={class:"input-container"};function p(e,t,n,a,r,i){const p=(0,o.g2)("Refresh"),f=(0,o.g2)("el-icon"),m=(0,o.g2)("el-button");return(0,o.uX)(),(0,o.CE)("div",l,[c,(0,o.Lk)("div",u,[(0,o.Lk)("ul",h,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.messages,((e,t)=>((0,o.uX)(),(0,o.CE)("li",{key:t,innerHTML:i.renderMarkdown(e),class:"chat-message"},null,8,g)))),128))])]),(0,o.Lk)("div",d,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.message=e),onKeyup:t[1]||(t[1]=(0,s.jR)(((...e)=>i.sendMessage&&i.sendMessage(...e)),["enter"])),placeholder:"输入你的消息...",class:"chat-input"},null,544),[[s.Jo,r.message]]),(0,o.bF)(m,{onClick:i.refresh,size:"large"},{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)(p)])),_:1})])),_:1},8,["onClick"]),r.isReciving?((0,o.uX)(),(0,o.Wv)(m,{key:1,size:"large",type:"primary",disabled:""},{default:(0,o.k6)((()=>[(0,o.eW)("发送")])),_:1})):((0,o.uX)(),(0,o.Wv)(m,{key:0,size:"large",onClick:i.sendMessage,class:"send-button"},{default:(0,o.k6)((()=>[(0,o.eW)("发送")])),_:1},8,["onClick"]))])])}n(4114);var f=n(357),m=n(1109),v=(n(6128),n(7477)),b={data(){return{message:"",messages:[],partialMsg:"#### Gemma：\n",isReciving:!1,isStop:!0}},components:{Refresh:v.C42},created(){this.loadHistory()},mounted(){this.$socket.on("message",(e=>{this.partialMsg+=e,0===this.messages.length||this.messages[this.messages.length-1].endsWith("<end_of_turn>")?this.messages.push(this.partialMsg):this.messages[this.messages.length-1]=this.partialMsg,e.endsWith("<end_of_turn>")&&(this.messages[this.messages.length-1]=this.partialMsg.replace("<end_of_turn>",""),this.partialMsg="#### Gemma：\n",this.isReciving=!1)})),window.addEventListener("beforeunload",(()=>{this.stop_chat()}))},updated(){this.scrollToBottom()},methods:{refresh(){this.$axios.delete("/restart_chat").then((e=>{let t=e.data;console.log(t),200===t.code&&(this.messages=[])}))},loadHistory(){this.$axios.get("/history_chat").then((e=>{let t=e.data;200===t.code&&(this.messages=t.data)})).catch((e=>{console.log(e)}))},stop_chat(){this.$axios.get("/stop_chat").then((e=>{200===e.status&&(this.isStop=!0)})).catch((e=>{console.log(e)}))},escapeMarkdown(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\*/g,"&#42;").replace(/_/g,"&#95;").replace(/`/g,"&#96;").replace(/\[/g,"&#91;").replace(/]/g,"&#93;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/#/g,"&#35;")},sendMessage(){this.$axios.get("/start_chat").then((e=>{console.log(e),200===e.status&&""!==this.message.trim()&&(this.messages.push("#### 用户：\n"+this.escapeMarkdown(this.message)+"<end_of_turn>"),this.isReciving=!0,this.$socket.send(this.message),this.message="")})).catch((e=>{console.log(e)}))},renderMarkdown(e){const t=(0,f.xI)(e);return this.$nextTick((()=>{this.hanleHightLight()})),t},scrollToBottom(){const e=this.$el.querySelector(".chat-log");e.scrollTop=e.scrollHeight},hanleHightLight(){let e=document.querySelectorAll("pre code");e.forEach((e=>{if(!e.parentNode.querySelector(".copy-button")){const t=document.createElement("span");t.className="copy-button",t.innerText="复制",e.parentNode.style.position="relative",e.parentNode.appendChild(t),t.addEventListener("click",(()=>{const n=e.innerText;navigator.clipboard.writeText(n).then((()=>{t.innerText="已复制",setTimeout((()=>{t.innerText="复制"}),2e3)}))}))}m.A.highlightElement(e)}))}}},k=n(1241);const y=(0,k.A)(b,[["render",p],["__scopeId","data-v-01a60c90"]]);var _=y,M={name:"App",components:{ChatContent:_}};const x=(0,k.A)(M,[["render",r]]);var C=x,T=n(7910),w=n(1950),L=(n(4188),n(4373));const O=(0,T.Ay)("http://localhost:5000"),E=(0,s.Ef)(C);E.config.globalProperties.$socket=O,E.use(w.A),L.A.defaults.baseURL="http://localhost:5000",L.A.defaults.timeout=1e4,E.config.globalProperties.$axios=L.A,E.mount("#app")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,a){if(!s){var r=1/0;for(u=0;u<e.length;u++){s=e[u][0],o=e[u][1],a=e[u][2];for(var i=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(i=!1,a<r&&(r=a));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[s,o,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,a,r=s[0],i=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var u=l(n)}for(t&&t(s);c<r.length;c++)a=r[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},s=self["webpackChunkgemma_vue"]=self["webpackChunkgemma_vue"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(4737)}));s=n.O(s)})();
//# sourceMappingURL=app.c9f7bc3f.js.map